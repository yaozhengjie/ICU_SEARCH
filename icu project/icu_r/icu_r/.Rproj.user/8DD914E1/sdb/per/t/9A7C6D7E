{
    "collab_server" : "",
    "contents" : "#提取两端是‘’的数据，并且在内部都是数字的数值\nsepsis3.0 = dbGetQuery(con,\"SELECT * FROM mimiciii.sepsis30_18\")\nwrite.table(sepsis3.0,file=\"sepsis30_18.csv\",sep =\",\",row.names = FALSE)\nlibrary(RSelenium)\nlibrary(stringr)\nlibrary(stringi)\nlibrary(RPostgreSQL)\n#rawdata = file(\"E:\\\\BaiduYunDownload\\\\mimic-code-master (2)\\\\mimic-code-master\\\\sepsis\\\\angus.sql\")\nrawdata = readLines(\"E:\\\\BaiduYunDownload\\\\mimic-code-master (2)\\\\mimic-code-master\\\\sepsis\\\\angus.sql\")\nm <- dbDriver(\"PostgreSQL\")\ncon <- dbConnect(m, user=\"postgres\", password=\"huayin303\",host=\"10.73.7.139\", dbname=\"mimic\")\nd_sepsis   = dbGetQuery(con,\"SELECT * FROM mimiciii.d_sepsis\")\ncon <- dbConnect(m, user=\"postgres\", password=\"huayin303\",host=\"10.73.7.139\", dbname=\"mimicv14\")\nd_icd_diagnoses = dbGetQuery(con,\"SELECT * FROM mimiciii.d_icd_diagnoses\")\nd_angus = dbGetQuery(con,\"SELECT * FROM mimiciii.d_angus\")\nd_organ = dbGetQuery(con,\"SELECT * FROM mimiciii.d_organ\")\n#转化成csv,不带行号的\nwrite.table(d_organ,file=\"d_organ.csv\",sep =\",\",row.names = FALSE)\n#rawdata = \"a 2 '1',101' ,'203', '204', small day!\"\n#zz = unlist(str_extract_all(rawdata,\"'[0-9]+'\"))\n#531\niinter = intersect(d_sepsis$row_id,d_angus$row_id)\n#并集\nouterr = union(d_sepsis$row_id,d_angus$row_id)\n#301\ndiffr = setdiff(d_sepsis$row_id,d_angus$row_id)\n#604\ndiffz = setdiff(d_angus$row_id, d_sepsis$row_id)\n#重新整理数据集，从整理中获取左联数据\nrr = subset(d_sepsis,d_sepsis$row_id %in% diffr)\nrrr = subset(d_icd_diagnoses,d_icd_diagnoses$row_id %in% diffr)\n#交集数据\nii = subset(d_icd_diagnoses,d_icd_diagnoses$row_id %in% iinter)\n\nzz = subset(d_icd_diagnoses,d_icd_diagnoses$row_id %in% diffz)\nwrite.table(zz,file=\"angus_fang.csv\",sep =\",\",row.names = FALSE)\nwrite.table(rrr,file=\"fang_angus.csv\",sep =\",\",row.names = FALSE)\nwrite.table(ii,file=\"angus&fang.csv\",sep =\",\",row.names = FALSE)\n\n#获取一百个随机sepsis30\nsepsis_100 = sample(sepsis3.0$hadm_id,100)\nunique(sepsis_100)\nsepsis_100 = as.character(sepsis_100)\nww = \"\"\nfor(i in 1:length(sepsis_100)){\n  if (i == 1)\n    ww = sepsis_100[i]\n  else\n    ww = paste(ww,\",\",sepsis_100[i])\n}\n\nsql = paste0(\"SELECT * FROM mimiciii.noteevents where category='Discharge summary' and hadm_id in \",\"(\",ww,\")\")\nnoteevent_100 = dbGetQuery(con,sql)\nwrite.table(noteevent_100,file=\"noteevent_100.csv\",sep =\",\",row.names = FALSE)\nresult = str_extract_all(noteevent_100$text,\"PAST MEDICAL HISTORY:|Past Medical History:\")\ndd = which(str_detect(noteevent_100$text,\"PAST MEDICAL HISTORY:|Past Medical History:\"))\n\nnoteevent_100_1 = data.frame(NULL)\na = rep(NA,106)\nfor(i in 1:106){\n  if (i %in% dd)\n    a[i] = noteevent_100$hadm_id[i]\n}\na = na.omit(a)\nsetdiff(noteevent_100$hadm_id,a)\n\n#######################################################################################################################\nzz = str_extract_all(noteevent_100$text, \"PAST MEDICAL HISTORY:\\n[^:]+|Past Medical History:\\n[^:]+\")\n#列表转向量的处理\nff = rep(NA,106)\nfor(i in 1:106){\n  if (length(zz[[i]]) == 0)\n    ff[i] = NA\n  else\n    ff[i] = zz[[i]][1]\n}\n\nnoteevent_100_2 = data.frame(noteevent_100,ff)\nwrite.csv(noteevent_100_2,file=\"fenxi106.csv\",row.names = FALSE)\n#字符处理,判断截取的数据是否过小，过小的就拉伸字数数量\nwe = nchar(ff)\nwhich(is.na(we))\nwee = ifelse(we>50,we,NA)\n#截取数据流向,反向处理\npp = stri_reverse(ff)\noo = str_extract(pp,\".+\\n\")\noi = stri_reverse(oo)\n\noi = factor(oi)\ntable(oi)\n#提取出相对应的项目\noii = data.frame(noteevent_100_2,oi,we,wee)\n\nsss = subset(oii,we < 50)\n####################################################################################################################\n#anysis all notetext data\n\nnotetext = dbGetQuery(con,\"SELECT * FROM mimiciii.notetext_sepsis3018\")\nwrite.csv(notetext,file=\"notetext.csv\",row.names = FALSE)\n##数据库已经做好了处理的工作，筛选》50个字符的数据，并提取他们结束的标题的\nnotetext_nchar = nchar(notetext$newtxt)\n\nwhich(is.na(notetext_nchar))\nnotetext_nchar_we = ifelse(notetext_nchar>200,notetext$newtxt,NA)\n#截取数据流向,反向处理\nnotetext_nchar_pp = stri_reverse(notetext_nchar_we)\nnotetext_nchar_oo = str_extract(notetext_nchar_pp,\".+\\n\")\nnotetext_nchar_oi = stri_reverse(notetext_nchar_oo)\n\nnotetext_nchar_oi = factor(notetext_nchar_oi)\n#善用sort，便于显示\nnotetext_freq  = sort(table(notetext_nchar_oi))\n#提取出相对应的项目\nnotetext_new = data.frame(notetext,notetext_nchar_oi)\nnotetext_freq = data.frame(notetext_freq)\nwrite.csv(notetext_freq,file=\"notetext_freq.csv\",row.names = FALSE)\n\n###choose the attributes which not start with -,or num [[:alpha:]]\nsubtext = str_sub(notetext_freq$notetext_nchar_oi,start = 2 , end = 2)\nresult_sub = ifelse(str_detect(subtext,\"[[:alpha:]]\"),1,0 )\n\n\nnotetext[which(result_sub == 1),]\n#展示的数据点，就是不以开头的数据\nnotetext_freq[which(result_sub == 1),]\nwrite.csv(notetext_freq[which(result_sub == 1),],file=\"notetext111.csv\",row.names = FALSE)\n##################################### restart to  solve###########################################################\n##choose the data \nwrite.csv(notetext,file=\"notetext.csv\",row.names = FALSE)\n\n###随机选择200例数据，进行处理\ntemp = na.omit(notetext)\ntemp = temp\nzz = sample(c(1:dim(temp)[1]),200)\nttemp = temp[zz,]\nwrite.csv(ttemp,file=\"sample200.csv\",row.names = FALSE)\n\n\n#create\nnotetext = dbGetQuery(con,\"SELECT * FROM mimiciii.notetext\")\nwrite.csv(ttemp,file=\"notetext_category_discharge_summary_PMH.csv\",row.names = FALSE)\n\n\n\n",
    "created" : 1476933452861.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3644252417",
    "id" : "9A7C6D7E",
    "lastKnownWriteTime" : 1477279199,
    "last_content_update" : 1477279199625,
    "path" : "C:/Users/Administrator/Desktop/icu project/icu_r/icu_r/提取文本数值.R",
    "project_path" : "提取文本数值.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 23,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}